<!DOCTYPE html>
<html>
<head>
  <title>Firebase Data Recovery Tool</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    button { padding: 10px 20px; margin: 10px; cursor: pointer; }
    pre { background: #f5f5f5; padding: 15px; overflow: auto; max-height: 600px; }
  </style>
</head>
<body>
  <h1>Firebase Data Recovery Tool</h1>
  <p>這個工具會檢查瀏覽器中是否有暫存的 Firebase 資料</p>

  <button onclick="checkIndexedDB()">檢查 IndexedDB</button>
  <button onclick="checkLocalStorage()">檢查 LocalStorage</button>
  <button onclick="checkSessionStorage()">檢查 SessionStorage</button>

  <h2>結果：</h2>
  <pre id="output">等待檢查...</pre>

  <script>
    function checkIndexedDB() {
      const output = document.getElementById('output');
      output.textContent = '正在檢查 IndexedDB...\n\n';

      indexedDB.databases().then(databases => {
        output.textContent += 'IndexedDB 資料庫列表：\n';
        output.textContent += JSON.stringify(databases, null, 2) + '\n\n';

        // 查找 Firebase 相關的資料庫
        const firebaseDB = databases.find(db =>
          db.name && (db.name.includes('firebase') || db.name.includes('firestore'))
        );

        if (firebaseDB) {
          output.textContent += '發現 Firebase 資料庫：' + firebaseDB.name + '\n';
          const request = indexedDB.open(firebaseDB.name);

          request.onsuccess = function(event) {
            const db = event.target.result;
            output.textContent += '資料庫物件存儲：\n';
            output.textContent += JSON.stringify(Array.from(db.objectStoreNames), null, 2);
          };
        } else {
          output.textContent += '未找到 Firebase 相關的 IndexedDB 資料\n';
        }
      });
    }

    function checkLocalStorage() {
      const output = document.getElementById('output');
      output.textContent = 'LocalStorage 內容：\n\n';

      const allKeys = Object.keys(localStorage);
      output.textContent += `總共 ${allKeys.length} 個項目\n\n`;

      allKeys.forEach(key => {
        const value = localStorage.getItem(key);
        output.textContent += `【${key}】\n`;

        // 嘗試解析 JSON
        try {
          const parsed = JSON.parse(value);
          output.textContent += JSON.stringify(parsed, null, 2) + '\n\n';
        } catch {
          output.textContent += value + '\n\n';
        }
      });

      if (allKeys.length === 0) {
        output.textContent += '未找到任何 LocalStorage 資料\n';
      }
    }

    function checkSessionStorage() {
      const output = document.getElementById('output');
      output.textContent = 'SessionStorage 內容：\n\n';

      const allKeys = Object.keys(sessionStorage);
      output.textContent += `總共 ${allKeys.length} 個項目\n\n`;

      allKeys.forEach(key => {
        const value = sessionStorage.getItem(key);
        output.textContent += `【${key}】\n`;

        try {
          const parsed = JSON.parse(value);
          output.textContent += JSON.stringify(parsed, null, 2) + '\n\n';
        } catch {
          output.textContent += value + '\n\n';
        }
      });

      if (allKeys.length === 0) {
        output.textContent += '未找到任何 SessionStorage 資料\n';
      }
    }
  </script>
</body>
</html>
