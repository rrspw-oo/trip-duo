# Firebase Realtime Database å®‰å…¨è¦å‰‡è¨­å®š

## è¨­å®šæ­¥é©Ÿ

1. å‰å¾€ [Firebase Console](https://console.firebase.google.com/)
2. é¸æ“‡ä½ çš„å°ˆæ¡ˆ `travel-fd`
3. é»æ“Šå·¦å´é¸å–®çš„ **Realtime Database**
4. é»æ“Š **Rules** æ¨™ç±¤
5. å°‡ä»¥ä¸‹è¦å‰‡è¤‡è£½ä¸¦è²¼ä¸Šåˆ°ç·¨è¼¯å™¨ä¸­
6. é»æ“Š **Publish** ç™¼å¸ƒè¦å‰‡

## å®‰å…¨è¦å‰‡

```json
{
  "rules": {
    "travelPlans": {
      "$planId": {
        ".read": "auth != null && ($planId === auth.uid || data.child('ownerUid').val() === auth.uid || data.child('users').hasChild(auth.uid))",
        ".write": "auth != null && ($planId === auth.uid || data.child('ownerUid').val() === auth.uid || data.child('users').hasChild(auth.uid) || newData.child('ownerUid').val() === auth.uid)"
      }
    },
    "invites": {
      "$code": {
        ".read": "auth != null",
        ".write": "auth != null"
      }
    },
    "users": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    }
  }
}
```

## è¦å‰‡èªªæ˜

### travelPlansï¼ˆæ—…è¡Œè¨ˆåŠƒï¼‰
- **è®€å–æ¬Šé™**: åªæœ‰è¨ˆåŠƒæ“æœ‰è€…æˆ–è¨ˆåŠƒæˆå“¡å¯ä»¥è®€å–
- **å¯«å…¥æ¬Šé™**: åªæœ‰è¨ˆåŠƒæ“æœ‰è€…æˆ–è¨ˆåŠƒæˆå“¡å¯ä»¥å¯«å…¥
- **é©—è­‰**: ç¢ºä¿æ–°è³‡æ–™åŒ…å« `ownerUid` å’Œ `users` æ¬„ä½

### invitesï¼ˆé‚€è«‹ç¢¼ï¼‰
- **è®€å–æ¬Šé™**: ä»»ä½•å·²ç™»å…¥ç”¨æˆ¶å¯ä»¥è®€å–ï¼ˆéœ€è¦é©—è­‰é‚€è«‹ç¢¼ï¼‰
- **å¯«å…¥æ¬Šé™**: ä»»ä½•å·²ç™»å…¥ç”¨æˆ¶å¯ä»¥å¯«å…¥ï¼ˆç”Ÿæˆé‚€è«‹ç¢¼ï¼‰

### usersï¼ˆç”¨æˆ¶è³‡æ–™ï¼‰
- **è®€å–æ¬Šé™**: åªæœ‰è©²ç”¨æˆ¶æœ¬äººå¯ä»¥è®€å–è‡ªå·±çš„è³‡æ–™
- **å¯«å…¥æ¬Šé™**: åªæœ‰è©²ç”¨æˆ¶æœ¬äººå¯ä»¥å¯«å…¥è‡ªå·±çš„è³‡æ–™

## æ¸¬è©¦è¦å‰‡

è¨­å®šå®Œæˆå¾Œï¼Œå¯ä»¥åœ¨ Firebase Console çš„ **Rules** é é¢ä½¿ç”¨ **Simulator** æ¸¬è©¦è¦å‰‡ï¼š

### æ¸¬è©¦æ¡ˆä¾‹ 1: ç”¨æˆ¶è®€å–è‡ªå·±çš„è¨ˆåŠƒ
```
Location: /travelPlans/user123
Auth: user123
Read: âœ… å…è¨±
```

### æ¸¬è©¦æ¡ˆä¾‹ 2: ç”¨æˆ¶è®€å–ä»–äººçš„è¨ˆåŠƒ
```
Location: /travelPlans/user456
Auth: user123
Read: âŒ æ‹’çµ•
```

### æ¸¬è©¦æ¡ˆä¾‹ 3: è¨ˆåŠƒæˆå“¡è®€å–å…±äº«è¨ˆåŠƒ
```
Location: /travelPlans/user123
Auth: user456 (users array includes user456)
Read: âœ… å…è¨±
```

## é‡è¦æé†’

âš ï¸ **è«‹å‹™å¿…è¨­å®šé€™äº›å®‰å…¨è¦å‰‡**ï¼Œå¦å‰‡ï¼š
- ä»»ä½•äººéƒ½å¯ä»¥è®€å–æ‰€æœ‰ç”¨æˆ¶çš„æ—…è¡Œè¨ˆåŠƒ
- ä»»ä½•äººéƒ½å¯ä»¥ä¿®æ”¹æˆ–åˆªé™¤ä»–äººçš„è³‡æ–™
- å¯èƒ½é€ æˆè³‡æ–™å¤–æ´©æˆ–æå£

## è³‡æ–™çµæ§‹åƒè€ƒ

```
Firebase Realtime Database:
â”œâ”€â”€ travelPlans/
â”‚   â””â”€â”€ {userId}/
â”‚       â”œâ”€â”€ ownerUid: "userId"
â”‚       â”œâ”€â”€ users: ["userId", "partnerId"]
â”‚       â”œâ”€â”€ startDate: "2025-10-01"
â”‚       â”œâ”€â”€ endDate: "2025-10-10"
â”‚       â”œâ”€â”€ totalDays: 10
â”‚       â”œâ”€â”€ flights: {...}
â”‚       â”œâ”€â”€ dailyPlans: {...}
â”‚       â”œâ”€â”€ essentials: {...}
â”‚       â””â”€â”€ createdAt: timestamp
â”œâ”€â”€ invites/
â”‚   â””â”€â”€ {code}/
â”‚       â”œâ”€â”€ planId: "userId"
â”‚       â”œâ”€â”€ status: "pending"
â”‚       â””â”€â”€ timestamp: timestamp
â””â”€â”€ users/
    â””â”€â”€ {uid}/
        â”œâ”€â”€ planId: "userId"
        â””â”€â”€ joinedAt: timestamp
```

## ğŸš¨ å¿«é€Ÿæ¸¬è©¦æ–¹æ¡ˆï¼ˆè‡¨æ™‚é–‹æ”¾è¦å‰‡ï¼‰

å¦‚æœæ‚¨æƒ³å…ˆæ¸¬è©¦åŠŸèƒ½ï¼Œå¯ä»¥æš«æ™‚ä½¿ç”¨ä»¥ä¸‹**é–‹æ”¾è¦å‰‡**ï¼š

```json
{
  "rules": {
    ".read": "auth != null",
    ".write": "auth != null"
  }
}
```

âš ï¸ **é€™å€‹è¦å‰‡å…è¨±ä»»ä½•ç™»å…¥ç”¨æˆ¶è®€å¯«æ‰€æœ‰è³‡æ–™ï¼Œåƒ…ç”¨æ–¼é–‹ç™¼æ¸¬è©¦ï¼**

### æ¸¬è©¦æ­¥é©Ÿï¼š
1. åœ¨ Firebase Console â†’ Realtime Database â†’ Rules è²¼ä¸Šä¸Šé¢çš„é–‹æ”¾è¦å‰‡
2. é»æ“Š "Publish"
3. æ¸¬è©¦æ‡‰ç”¨åŠŸèƒ½ï¼ˆå»ºç«‹è¨ˆåŠƒã€åŠ å…¥è¨ˆåŠƒã€å³æ™‚åŒæ­¥ï¼‰
4. **æ¸¬è©¦å®Œæˆå¾Œï¼Œè«‹æ”¹å›æœ¬æ–‡æª”é ‚éƒ¨çš„å®‰å…¨è¦å‰‡ï¼**

## å¸¸è¦‹å•é¡Œ

**Q: è¨­å®šè¦å‰‡å¾Œç¾æœ‰è³‡æ–™æœƒæ¶ˆå¤±å—ï¼Ÿ**
A: ä¸æœƒï¼Œè¦å‰‡åªå½±éŸ¿è®€å¯«æ¬Šé™ï¼Œä¸æœƒåˆªé™¤è³‡æ–™ã€‚

**Q: å¦‚æœè¨­å®šéŒ¯èª¤æœƒæ€æ¨£ï¼Ÿ**
A: ç”¨æˆ¶å¯èƒ½ç„¡æ³•è®€å–æˆ–å¯«å…¥è³‡æ–™ï¼Œæœƒçœ‹åˆ°æ¬Šé™éŒ¯èª¤ã€‚å¯ä»¥éš¨æ™‚åœ¨ Firebase Console ä¿®æ”¹è¦å‰‡ã€‚

**Q: ç‚ºä»€éº¼æœƒå‡ºç¾ PERMISSION_DENIED éŒ¯èª¤ï¼Ÿ**
A: å¯èƒ½åŸå› ï¼š
1. Firebase è¦å‰‡è¨­å®šä¸æ­£ç¢º
2. ç”¨æˆ¶æœªç™»å…¥
3. è¦å‰‡å°šæœªç™¼å¸ƒ
4. ç€è¦½å™¨å¿«å–å•é¡Œï¼ˆå˜—è©¦ç¡¬åˆ·æ–° Ctrl+Shift+Rï¼‰

**Q: é–‹ç™¼æ¸¬è©¦ç”¨ä»€éº¼è¦å‰‡æœ€ç°¡å–®ï¼Ÿ**
A: ä½¿ç”¨ä¸Šé¢çš„ã€Œå¿«é€Ÿæ¸¬è©¦æ–¹æ¡ˆã€é–‹æ”¾è¦å‰‡ï¼Œä½†**æ¸¬è©¦å®Œå‹™å¿…æ”¹å›å®‰å…¨è¦å‰‡**ï¼
